#include <Servo.h>
#include <math.h>

struct dest {
  int8_t x;
  int8_t y;
} dest;

struct Letter {
  uint8_t dests[15][3];
};

Letter arr [26] = {{{{15,90,0},{50,10,1},{85,90,1},{33,50,0},{66,50,1},{100,0,0}}},
                  {{{20,10,0},{20,90,1},{80,66,1},{20,50,1},{80,33,1},{20,10,1},{100,0,0}}},
                  {{{80,15,0},{30,15,1},{15,50,1},{30,85,1},{80,85,1},{100,0,0}}},
                  {{{15,15,0},{15,85,1},{70,85,1},{85,50,1},{70,15,1},{15,15,1},{100,0,0}}},
                  {{{80,15,0},{20,15,1},{20,85,1},{80,85,1},{20,50,0},{60,50,1},{100,0,0}}},
                  {{{80,15,0},{20,15,1},{20,85,1},{20,50,0},{60,50,1},{100,0,0}}},
                  {{{80,15,0},{30,15,1},{15,50,1},{30,85,1},{80,85,1},{80,50,1},{60,50,1},{100,0,0}}},
                  {{{20,15,0},{20,85,1},{80,85,0},{80,15,1},{20,50,0},{80,50,1},{100,0,0}}},
                  {{{20,15,0},{80,15,1},{20,85,0},{80,85,1},{50,85,0},{50,15,1},{100,0,0}}},
                  {{{15,65,0},{25,85,1},{40,85,1},{50,65,1},{50,15,1},{20,15,0},{80,15,1},{100,0,0}}},
                  {{{20,15,0},{20,85,1},{20,50,0},{80,15,1},{20,50,0},{80,85,1},{100,0,0}}},
                  {{{20,15,0},{20,85,1},{80,85,1},{100,0,0}}},
                  {{{20,85,0},{20,15,1},{50,50,1},{80,15,1},{80,85,1},{100,0,0}}},
                  {{{20,85,0},{20,15,1},{80,85,1},{80,15,1},{100,0,0}}},
                  {{{30,15,0},{15,30,1},{15,70,1},{30,85,1},{70,85,1},{85,70,1},{85,30,1},{70,15,1},{30,15,1},{100,0,0}}},
                  {{{20,85,0},{20,15,1},{80,15,1},{80,50,1},{20,50,1},{100,0,0}}},
                  {{{30,15,0},{15,30,1},{15,70,1},{30,85,1},{70,85,1},{85,70,1},{85,30,1},{70,15,1},{30,15,1},{70,70,0},{85,85,1},{100,0,0}}},
                  {{{20,85,0},{20,15,1},{80,15,1},{80,50,1},{20,50,1},{80,85,1},{100,0,0}}},
                  {{{80,15,0},{20,15,1},{20,50,1},{80,50,1},{80,85,1},{20,85,1},{100,0,0}}},
                  {{{50,85,0},{50,15,1},{20,15,0},{80,15,1},{100,0,0}}},
                  {{{20,15,0},{20,85,1},{80,85,1},{80,15,1},{100,0,0}}},
                  {{{20,15,0},{50,85,1},{80,15,1},{100,0,0}}},
                  {{{15,15,0},{20,85,1},{50,50,1},{80,85,1},{85,15,1},{100,0,0}}},
                  {{{20,15,0},{80,85,1},{20,85,0},{80,15,1},{100,0,0}}},
                  {{{20,15,0},{50,50,1},{80,15,1},{50,50,0},{50,85,1},{100,0,0}}},
                  {{{20,15,0},{80,15,1},{20,85,1},{80,85,1},{100,0,0}}}};

Servo ll;
Servo lr;

Servo ul;
Servo ur;

Servo b;

int currentX = 0;
int currentY = 0;

int speed = 100;
int refresh_rate = 0.1; //seconds

int letterDensity = 1;

void setup() {
  //fillArr();
  pinMode(2, OUTPUT);
  pinMode(3, OUTPUT);
  pinMode(4, OUTPUT);
  pinMode(5, OUTPUT);
  pinMode(6, OUTPUT);
  // put your setup code here, to run once:
  ll.attach(2);
  lr.attach(3);
  ul.attach(4);
  ur.attach(5);
  b.attach(6);
  Serial.begin(9600);
  lower_cart(0);
  upper_cart(0);
}

void loop() {
  write_letter('A');
}

void percent(Servo servo, int percent){
  servo.write(percent * 180 / 100);
}

void lower_cart(int y){
  percent(lr, y);
  percent(ll, 100-y);
}

void upper_cart(int x){
  percent(ur, x);
  percent(ul, 100-x);
}

void burn(bool burn){
  b.write(burn?100:0);
}

void drive_line(dest d, bool burn){
  burn(burn);
  int x1 = currentX;
  int y1 = currentY;
  int x2 = d.x;
  int y2 = d.y;
  int dx = x2 - x1;
  int dy = y2 - y1;
  double length = sqrt((dx*dx) + (dy*dy));
  double duration = length / speed;
  int count = duration/refresh_rate;
  for(int i = 0; i < count; i++){
    lower_cart(dy/i + y1);
    upper_cart(dx/i + x1);
  }
}

void write_letter(char letter){
  Letter l = arr[letter - 'A'];
  for(int i = 0; i < l.dests.length; i++){
    dest target = {l.dests[i][0], l.dests[i][1]};
    drive_line(target, (l.dests[i][2] != 0));
  }
}























